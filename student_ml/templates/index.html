<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Predictor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: #4f46e5;
            padding: 24px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .form-container {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .form-group input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input[type="number"]:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-group input.error {
            border-color: #ef4444;
        }

        .form-group .field-error {
            color: #ef4444;
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .form-group .hint {
            color: #6b7280;
            font-size: 0.75rem;
            margin-top: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin-bottom: 0;
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: #4338ca;
        }

        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .error-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            display: none;
        }

        .error-box.show {
            display: block;
        }

        .error-box h3 {
            color: #dc2626;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .error-box ul {
            margin: 0;
            padding-left: 20px;
            color: #b91c1c;
            font-size: 0.85rem;
        }

        .error-box li {
            margin-bottom: 4px;
        }

        .result-box {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .result-box.show {
            display: block;
        }

        .result-box h3 {
            color: #166534;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .result-box .score {
            font-size: 3rem;
            font-weight: 700;
            color: #15803d;
        }

        .result-box .grade {
            display: inline-block;
            background: #22c55e;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }

        .student-type {
            margin-top: 16px;
            padding: 12px;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
        }

        .student-type .label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .student-type .type {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e40af;
        }

        .student-type .description {
            font-size: 0.85rem;
            color: #374151;
            margin-top: 4px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .loading .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #e5e7eb;
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .time-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            display: none;
        }

        .time-warning.show {
            display: block;
        }

        .time-warning p {
            color: #92400e;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .risk-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .risk-badge.critical {
            background: #fecaca;
            color: #dc2626;
        }

        .risk-badge.high {
            background: #fed7aa;
            color: #ea580c;
        }

        .risk-badge.medium {
            background: #fef08a;
            color: #ca8a04;
        }

        .risk-badge.low {
            background: #bbf7d0;
            color: #16a34a;
        }

        .warnings-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            text-align: left;
            display: none;
        }

        .warnings-box.show {
            display: block;
        }

        .warnings-box h4 {
            color: #dc2626;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .warnings-box ul {
            margin: 0;
            padding-left: 20px;
            color: #b91c1c;
            font-size: 0.8rem;
        }

        .warnings-box li {
            margin-bottom: 6px;
        }

        .recommendations-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            text-align: left;
            display: none;
        }

        .recommendations-box.show {
            display: block;
        }

        .recommendations-box h4 {
            color: #1d4ed8;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .recommendations-box ul {
            margin: 0;
            padding-left: 20px;
            color: #1e40af;
            font-size: 0.8rem;
        }

        .recommendations-box li {
            margin-bottom: 6px;
        }

        .input-warnings-box {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            text-align: left;
            display: none;
        }

        .input-warnings-box.show {
            display: block;
        }

        .input-warnings-box h4 {
            color: #b45309;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .input-warnings-box ul {
            margin: 0;
            padding-left: 20px;
            color: #92400e;
            font-size: 0.8rem;
        }

        .input-warnings-box li {
            margin-bottom: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Student Performance Predictor</h1>
        </div>
        
        <div class="form-container">
            <div class="time-warning" id="timeWarning">
                <p>‚ö†Ô∏è <strong>Warning:</strong> Study hours + Sleep hours exceed 24 hours per day. This is impossible.</p>
            </div>

            <form id="predictionForm">
                <div class="form-group">
                    <label for="hours_studied">Hours Studied (per day)</label>
                    <input type="number" id="hours_studied" name="hours_studied" min="0" max="24" required>
                    <div class="hint">Enter 0-24</div>
                    <div class="field-error" id="hours_studied_error"></div>
                </div>

                <div class="form-group">
                    <label for="previous_scores">Previous Scores (%)</label>
                    <input type="number" id="previous_scores" name="previous_scores" min="0" max="100" required>
                    <div class="hint">Enter 0-100</div>
                    <div class="field-error" id="previous_scores_error"></div>
                </div>

                <div class="form-group">
                    <label for="sleep_hours">Sleep Hours (per night)</label>
                    <input type="number" id="sleep_hours" name="sleep_hours" min="0" max="24" required>
                    <div class="hint">Enter 0-24</div>
                    <div class="field-error" id="sleep_hours_error"></div>
                </div>

                <div class="form-group">
                    <label for="sample_papers">Sample Papers Practiced</label>
                    <input type="number" id="sample_papers" name="sample_papers" min="0" max="20" required>
                    <div class="hint">Enter 0-20</div>
                    <div class="field-error" id="sample_papers_error"></div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="extracurricular" name="extracurricular">
                        <label for="extracurricular">Participates in Extracurricular Activities</label>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">Predict Performance</button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Predicting...</p>
            </div>

            <div class="error-box" id="errorBox">
                <h3>Validation Errors</h3>
                <ul id="errorList"></ul>
            </div>

            <div class="result-box" id="resultBox">
                <h3>Predicted Performance Index</h3>
                <div class="score" id="scoreValue">--</div>
                <div class="grade" id="gradeValue">Grade: --</div>
                <div class="risk-badge" id="riskBadge">Risk: --</div>
                <div class="student-type">
                    <div class="label">Student Classification</div>
                    <div class="type" id="studentType">--</div>
                    <div class="description" id="studentDescription">--</div>
                </div>
                
                <div class="warnings-box" id="warningsBox">
                    <h4>‚ö†Ô∏è Warnings</h4>
                    <ul id="warningsList"></ul>
                </div>
                
                <div class="recommendations-box" id="recommendationsBox">
                    <h4>üí° Recommendations</h4>
                    <ul id="recommendationsList"></ul>
                </div>
                
                <div class="input-warnings-box" id="inputWarningsBox">
                    <h4>‚ö†Ô∏è Input Concerns</h4>
                    <ul id="inputWarningsList"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function clearErrors() {
            document.querySelectorAll('.field-error').forEach(el => el.textContent = '');
            document.querySelectorAll('input').forEach(el => el.classList.remove('error'));
            document.getElementById('errorBox').classList.remove('show');
            document.getElementById('errorList').innerHTML = '';
        }

        function showFieldError(field, message) {
            const input = document.getElementById(field);
            const errorEl = document.getElementById(field + '_error');
            if (input) input.classList.add('error');
            if (errorEl) errorEl.textContent = message;
        }

        function showErrors(errors) {
            const errorBox = document.getElementById('errorBox');
            const errorList = document.getElementById('errorList');
            errorList.innerHTML = '';
            
            errors.forEach(err => {
                const li = document.createElement('li');
                li.textContent = err;
                errorList.appendChild(li);
            });
            
            errorBox.classList.add('show');
        }

        function getGrade(score) {
            if (score >= 90) return 'A+';
            if (score >= 80) return 'A';
            if (score >= 70) return 'B';
            if (score >= 60) return 'C';
            if (score >= 50) return 'D';
            return 'F';
        }

        function validateForm(data) {
            const errors = [];
            
            if (data.hours_studied < 0 || data.hours_studied > 24) {
                errors.push('Hours studied must be between 0 and 24');
                showFieldError('hours_studied', 'Must be 0-24');
            }
            
            if (data.previous_scores < 0 || data.previous_scores > 100) {
                errors.push('Previous scores must be between 0 and 100');
                showFieldError('previous_scores', 'Must be 0-100');
            }
            
            if (data.sleep_hours < 0 || data.sleep_hours > 24) {
                errors.push('Sleep hours must be between 0 and 24');
                showFieldError('sleep_hours', 'Must be 0-24');
            }
            
            if (data.sample_papers < 0 || data.sample_papers > 20) {
                errors.push('Sample papers must be between 0 and 20');
                showFieldError('sample_papers', 'Must be 0-20');
            }
            
            // Check if study + sleep hours exceed 24
            const totalHours = data.hours_studied + data.sleep_hours;
            if (totalHours > 24) {
                errors.push(`Study hours (${data.hours_studied}) + Sleep hours (${data.sleep_hours}) = ${totalHours} hours exceeds 24 hours per day`);
                showFieldError('hours_studied', 'Total exceeds 24h');
                showFieldError('sleep_hours', 'Total exceeds 24h');
            }
            
            return errors;
        }

        function updateTimeWarning() {
            const hoursStudied = parseInt(document.getElementById('hours_studied').value) || 0;
            const sleepHours = parseInt(document.getElementById('sleep_hours').value) || 0;
            const timeWarning = document.getElementById('timeWarning');
            
            if (hoursStudied + sleepHours > 24) {
                timeWarning.classList.add('show');
            } else {
                timeWarning.classList.remove('show');
            }
        }

        // Add event listeners for real-time time validation
        document.getElementById('hours_studied').addEventListener('input', updateTimeWarning);
        document.getElementById('sleep_hours').addEventListener('input', updateTimeWarning);

        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            clearErrors();
            
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const resultBox = document.getElementById('resultBox');
            
            const data = {
                hours_studied: parseInt(document.getElementById('hours_studied').value) || 0,
                previous_scores: parseInt(document.getElementById('previous_scores').value) || 0,
                extracurricular: document.getElementById('extracurricular').checked,
                sleep_hours: parseInt(document.getElementById('sleep_hours').value) || 0,
                sample_papers: parseInt(document.getElementById('sample_papers').value) || 0
            };
            
            const validationErrors = validateForm(data);
            
            if (validationErrors.length > 0) {
                showErrors(validationErrors);
                resultBox.classList.remove('show');
                return;
            }
            
            submitBtn.disabled = true;
            loading.classList.add('show');
            resultBox.classList.remove('show');
            
            try {
                const response = await fetch('/api/predict/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                loading.classList.remove('show');
                submitBtn.disabled = false;
                
                if (response.ok) {
                    const score = result.predicted_performance_index;
                    document.getElementById('scoreValue').textContent = score.toFixed(1);
                    document.getElementById('gradeValue').textContent = 'Grade: ' + getGrade(score);
                    
                    // Display student classification (correct field names from API)
                    document.getElementById('studentType').textContent = result.student_classification || '--';
                    document.getElementById('studentDescription').textContent = result.description || '--';
                    
                    // Display risk level badge
                    const riskBadge = document.getElementById('riskBadge');
                    const riskLevel = result.risk_level || 'Low';
                    riskBadge.textContent = 'Risk: ' + riskLevel;
                    riskBadge.className = 'risk-badge ' + riskLevel.toLowerCase();
                    
                    // Display warnings from analysis
                    const warningsBox = document.getElementById('warningsBox');
                    const warningsList = document.getElementById('warningsList');
                    warningsList.innerHTML = '';
                    const warnings = result.analysis?.warnings || [];
                    if (warnings.length > 0) {
                        warnings.forEach(w => {
                            const li = document.createElement('li');
                            li.textContent = w;
                            warningsList.appendChild(li);
                        });
                        warningsBox.classList.add('show');
                    } else {
                        warningsBox.classList.remove('show');
                    }
                    
                    // Display recommendations from analysis
                    const recommendationsBox = document.getElementById('recommendationsBox');
                    const recommendationsList = document.getElementById('recommendationsList');
                    recommendationsList.innerHTML = '';
                    const recommendations = result.analysis?.recommendations || [];
                    if (recommendations.length > 0) {
                        recommendations.forEach(r => {
                            const li = document.createElement('li');
                            li.textContent = r;
                            recommendationsList.appendChild(li);
                        });
                        recommendationsBox.classList.add('show');
                    } else {
                        recommendationsBox.classList.remove('show');
                    }
                    
                    // Display input warnings
                    const inputWarningsBox = document.getElementById('inputWarningsBox');
                    const inputWarningsList = document.getElementById('inputWarningsList');
                    inputWarningsList.innerHTML = '';
                    const inputWarnings = result.input_warnings || [];
                    if (inputWarnings.length > 0) {
                        inputWarnings.forEach(w => {
                            const li = document.createElement('li');
                            li.textContent = w;
                            inputWarningsList.appendChild(li);
                        });
                        inputWarningsBox.classList.add('show');
                    } else {
                        inputWarningsBox.classList.remove('show');
                    }
                    
                    resultBox.classList.add('show');
                } else {
                    const errors = [];
                    if (result.errors) {
                        Object.entries(result.errors).forEach(([field, msgs]) => {
                            const msg = Array.isArray(msgs) ? msgs.join(', ') : msgs;
                            errors.push(`${field}: ${msg}`);
                            showFieldError(field, msg);
                        });
                    } else if (result.error) {
                        errors.push(result.error);
                    }
                    showErrors(errors);
                }
                
            } catch (error) {
                loading.classList.remove('show');
                submitBtn.disabled = false;
                showErrors(['Could not connect to server. Make sure Django is running.']);
            }
        });
    </script>
</body>
</html>
